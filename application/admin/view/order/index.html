{extend name="base/common"}

{block name="style"}
<style>
    .shadow{width: 100%;height: 100%;position: absolute;left: 0;top: 0;background: rgba(0,0,0,0.4);z-index: 88;}
    .imgs img {
        display: block;
        width: 100%;
        height: 300px;
    }
</style>
{/block}

{block name="page-header"}

{/block}

{block name="main"}
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="mail-box-header">
                    <h2>订单管理</h2>
                    <div class="mail-tools tooltip-demo m-t-md">
                        <input class="i-checks check-all" type="checkbox">

                        <form method="get" action="" class="pull-right mail-search">
                            <div class="input-group">
                                <input type="text" class="form-control input-sm" name="search" placeholder="搜索标题">
                                <div class="input-group-btn">
                                    <button type="submit" class="btn btn-sm btn-primary"><i class="fa fa-search"></i> 搜索</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="ibox-content">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th></th>
                                <td>所属场馆</td>
                                <th>下单人 </th>
                                <th>联系电话 </th>
                                <th>商品名称</th>
                                <th>数量</th>
                                <th>下单时间</th>
                                <!--<th>是否推荐</th>-->
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                            </thead>
                            <tbody>
                            {volist name="list" id="vo"}
                            <tr>
                                <td><input type="checkbox" class="i-checks ids" name="ids[]"></td>
                                <td>{$vo.depart}</td>
                                <td>{$vo.name|msubstr=0,20}</td>
                                <td>{$vo.mobile}</td>
                                <td>{$vo.title|msubstr=0,20}</td>
                                <td>{$vo.num}</td>
                                <td>{$vo.create_time}</td>
                                <td>{$vo.status_text}</td>
                                <td>
                                    <!--<a href="javascript:showIframe({$vo.id})" class="confirm btn-sm btn-primary"> 预览</a>-->
                                    <a data-toggle="modal" href="#show" onclick="detail(this)" class="btn-sm btn-success"
                                       data-detail='{$vo}'
                                       style="color: #fff;"><i class="fa fa-eye"></i>预览</a>
                                    <!--&emsp;<a href="{:Url('Venue/edit?id='.$vo['id'])}">修改</a>-->
                                    <!--&emsp;<a href="{:Url('Venue/del?id='.$vo['id'])}" class="confirm ajax-del">删除</a>-->
                                </td>
                            </tr>
                            {/volist}
                            </tbody>
                            <tfoot>
                            <tr>
                                <td colspan="10">
                                    <div class="page">{$_page}</div>
                                </td>
                            </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<iframe id="iframe" src="" style="height: 80%;width: 60%;z-index: 99;position: absolute;top: 10%;border: 0;left: 50%;margin-left: -30%;background: #fff;display: none;" scrolling="auto" seamless></iframe>
<div class="shadow" style="display: none"></div>

<div id="show" class="modal fade" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form class="form-horizontal" method="post" action="">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span
                            aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h2 class="modal-title text-center">预览</h2>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <div class="col-lg-2 text-right control-label">
                            <label>商品名称:</label>
                        </div>
                        <div class="col-lg-10">
                            <input readonly type="text" class="form-control form_title" name="title">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-lg-2 text-right control-label">
                            <label>数量:</label>
                        </div>
                        <div class="col-lg-10">
                            <input readonly type="text" class="form-control form_title" name="num">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-lg-2 text-right control-label">
                            <label>下单人:</label>
                        </div>
                        <div class="col-lg-10">
                            <input readonly type="text" class="form-control form_title" name="name">
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-lg-2 text-right control-label">
                            <label>所属场馆:</label>
                        </div>
                        <div class="col-lg-10">
                            <input readonly type="text" class="form-control form_title" name="depart">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-lg-2 text-right control-label">
                            <label>联系电话:</label>
                        </div>
                        <div class="col-lg-10">
                            <input readonly type="text" class="form-control form_title" name="mobile">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-lg-2 text-right control-label">
                            <label>下单时间:</label>
                        </div>
                        <div class="col-lg-10">
                            <input readonly type="text" class="form-control form_title" name="create_time">
                        </div>
                    </div>
                    <div class="form-group imgs">
                        <div class="col-lg-12">
                            <img src="" alt="">
                        </div>
                    </div>

                <div class="modal-footer">

                </div>
            </form>
        </div>
    </div>
</div>
{/block}

{block name="script"}
<script src="/admin/js/plugins/iCheck/icheck.min.js"></script>
<script>
    $(document).ready(function(){
        $('.i-checks').iCheck({
            checkboxClass: 'icheckbox_square-green',
            radioClass: 'iradio_square-green',
        });
        $(".check-all").on("ifChanged",function(){
            $("tbody").find(".ids").iCheck("toggle");
        });
    });

    function showIframe(myid){
        var iframe = $("#iframe");
        var url = "/admin/order/preview/id/" + myid;
        iframe.attr("src",url);
        iframe.show();
        $(".shadow").show();
        $(".wrapper").css("z-index",0);
        close(iframe);
    }

    function close(ele){
        $(".shadow").on('click',function(){
            $(this).hide();
            ele.hide();
        });
    }


    function detail(a) {
        var data = JSON.parse($(a).attr('data-detail'));
        console.log(data);
        $("input[name='title']").val(data.title);
        $("input[name='num']").val(data.num);
        $("input[name='name']").val(data.name);
        $("input[name='depart']").val(data.depart);
        $("input[name='mobile']").val(data.mobile);
        $("input[name='create_time']").val(data.create_time);
        $(".imgs img").attr('src',data.front_cover);
    }
</script>
{/block}